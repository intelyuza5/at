<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>出席フォーム</title>
  <style>
    body { font-family: sans-serif; padding: 2em; background: #f9f9f9; }
    form { background: white; padding: 1.5em; border-radius: 10px; box-shadow: 0 0 10px #ccc; max-width: 400px; margin: auto; }
    label { display: block; margin-top: 1em; }
    input { width: 100%; padding: 0.5em; font-size: 1em; }
    button { margin-top: 1.5em; padding: 0.8em; width: 100%; font-size: 1em; background: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer; }
    button:hover { background: #45a049; }
    #result { margin-top: 1em; font-weight: bold; text-align: center; }
  </style>
</head>
<body>

  <form id="attendanceForm">
    <h2>出席フォーム</h2>

    <label for="name">名前：</label>
    <input type="text" id="name" name="name" required>

    <label for="pin">4桁のPIN：</label>
    <input type="password" id="pin" name="pin" pattern="\d{4}" required>

    <button type="button" onclick="submitAttendance()">出席する</button>

    <p id="result"></p>
  </form>

  <script>
    async function submitAttendance() {
      const name = document.getElementById("name").value.trim();
      const pin = document.getElementById("pin").value.trim();
      const resultEl = document.getElementById("result");

      if (!/^\d{4}$/.test(pin)) {
        resultEl.textContent = "⚠️ PINは4桁の数字で入力してください。";
        return;
      }

      resultEl.textContent = "送信中...";

      try {
        const response = await fetch("https://script.google.com/macros/s/AKfycbysZO7zUOi1goQ3azaH7SX1Eo2LtUz_F05l0bzx93ZO8MJSJ4jOOnGJuaiGK6mlpQ8i/exec", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({ name, pin })
      });

        const res = await response.json();

        if (res.status === "success") {
          resultEl.textContent = `✅ 出席完了：${res.name}`;
        } else {
          resultEl.textContent = `❌ エラー：${res.message}`;
        }

      } catch (error) {
        console.error(error);
        resultEl.textContent = "❌ 通信エラー：GASの公開設定やURLを確認してください。";
      }
    }
  </script>

</body>
</html>
